import{c as C,d as _,f as u,h}from"./chunk-XL3ZRAIB.js";import{a as N}from"./chunk-ZXTOKJOT.js";import{a as Y}from"./chunk-YRR5DQPE.js";import{e as R,f as j,l as A}from"./chunk-JFV6WPIM.js";import"./chunk-3SYVYTXG.js";import{$ as x,$a as r,Aa as n,Ab as M,Ja as I,Oa as k,U as S,Ub as V,Va as d,Vb as O,Xb as B,Yb as $,_ as g,_a as e,_b as Q,ab as p,bb as D,cb as T,db as w,eb as f,fb as y,jb as F,kb as i,lb as E,mb as m,vb as b,xa as P,xb as v}from"./chunk-C5O2SOKF.js";function z(l,a){if(l&1&&(e(0,"span",32),i(1),r()),l&2){let t=a.$implicit;n(),m(" ",t.nombre," ")}}function G(l,a){if(l&1){let t=w();e(0,"div",17),p(1,"img",18),e(2,"div",19)(3,"h3",20),i(4),r(),e(5,"p",21),i(6),r(),e(7,"p",21),i(8),r(),e(9,"p",21),i(10),r(),e(11,"p",21),i(12),b(13,"date"),r(),e(14,"div",22),k(15,z,2,1,"span",23),r(),e(16,"div",24)(17,"button",25),f("click",function(){let c=g(t).$implicit,o=y(2);return x(o.decreaseQuantity(c.id_producto))}),p(18,"i",26),r(),e(19,"span",27),i(20),r(),e(21,"button",25),f("click",function(){let c=g(t).$implicit,o=y(2);return x(o.increaseQuantity(c.id_producto))}),p(22,"i",28),r(),e(23,"button",29),f("click",function(){let c=g(t).$implicit,o=y(2);return x(o.removeProduct(c))}),p(24,"i",30),r()()(),e(25,"div",31),i(26),b(27,"number"),r()()}if(l&2){let t=a.$implicit;d("@dropToCart",void 0)("@removeFromCart",void 0),n(),d("src",t.imagen_url||"https://via.placeholder.com/100",P)("alt",t.nombre),n(3),E(t.nombre),n(2),m("\u{1F4E6} Stock: ",t.stock,""),n(2),m("\u{1F3ED} Proveedor: ",t.proveedor,""),n(2),m("\u{1F4CD} Direcci\xF3n: ",t.direccion,""),n(2),m("\u{1F4C5} Fecha: ",v(13,12,t.fecha_creacion,"mediumDate"),""),n(3),d("ngForOf",t.categorias),n(5),E(t.quantity),n(6),m(" $",v(27,15,t.precio*t.quantity,"1.2-2")," ")}}function L(l,a){if(l&1&&(D(0),k(1,G,28,18,"div",16),T()),l&2){let t=y();n(),d("ngForOf",t.cart())("ngForTrackBy",t.trackById)}}function H(l,a){l&1&&(e(0,"div",33),p(1,"i",34),e(2,"div",35),i(3,"Tu carrito est\xE1 vac\xEDo"),r(),e(4,"div",36),i(5,"Agrega productos para comenzar tu compra."),r(),e(6,"a",37),i(7," Ir al cat\xE1logo "),r()())}var q=class l{cartService=S(N);facturaService=S(Y);router=S(R);cart=this.cartService.cart;total=this.cartService.total;isSubmitting=!1;errorMessage="";successMessage="";confirmarPago(){let a=localStorage.getItem("token"),t=localStorage.getItem("user_id");if(!a||!t){this.errorMessage="Debe iniciar sesi\xF3n para realizar el pago.";return}let s=this.cart().map(o=>((!o.id_producto||!o.quantity)&&console.error("Producto inv\xE1lido detectado:",o),{id:o.id_producto,cantidad:o.quantity})),c={usuario_id:+t,productos:s,fecha:new Date().toISOString()};console.log("Enviando payload a la API:",c),this.isSubmitting=!0,this.facturaService.crearFactura(c).subscribe({next:()=>{this.successMessage="\xA1Pago realizado con \xE9xito! Gracias por su compra.",this.cartService.cart.set([]),setTimeout(()=>this.router.navigate(["/"]),2e3)},error:o=>{console.error("Error HTTP al crear factura:",o),o.status===422?this.errorMessage="Error en los datos enviados. Revisa los productos y vuelve a intentar.":this.errorMessage="Error al procesar el pago. Intente nuevamente.",this.isSubmitting=!1}})}increaseQuantity(a){this.cartService.increaseQuantity(a)}decreaseQuantity(a){this.cartService.decreaseQuantity(a)}removeProduct(a){this.cartService.removeProduct(a)}onPay(){alert("Gracias por tu compra! \u{1F9FE} Se ha procesado correctamente."),this.cartService.cart.set([])}trackById(a,t){return t.id_producto}static \u0275fac=function(t){return new(t||l)};static \u0275cmp=I({type:l,selectors:[["payment"]],decls:40,vars:13,consts:[["emptyCart",""],[1,"max-w-7xl","mx-auto","p-6","grid","grid-cols-1","lg:grid-cols-3","gap-6","mt-20"],[1,"lg:col-span-2"],[1,"bg-white","dark:bg-gray-800","rounded-2xl","shadow-lg","border","border-gray-200","dark:border-gray-700","p-6","min-h-[300px]","flex","flex-col","justify-center"],[4,"ngIf","ngIfElse"],[1,"bg-white","dark:bg-gray-900","p-6","rounded-lg","shadow-lg","border","border-gray-300","dark:border-gray-700","sticky","top-20","h-fit"],[1,"text-xl","font-bold","text-gray-800","dark:text-white","mb-4"],[1,"text-sm","text-gray-700","dark:text-gray-300","space-y-2"],[1,"flex","justify-between"],[1,"font-semibold","text-green-600","dark:text-green-400"],[1,"my-4","border-gray-300","dark:border-gray-600"],[1,"flex","justify-between","text-lg","font-bold","text-gray-800","dark:text-white","mb-4"],[1,"text-green-600","dark:text-green-400"],[1,"cursor-pointer","w-full","py-3","bg-blue-600","hover:bg-blue-700","text-white","rounded-lg","font-semibold","transition","disabled:opacity-50",3,"click","disabled"],[1,"text-xs","text-gray-400","mt-2","text-center"],["href","#",1,"underline"],["class","flex items-start gap-4 mb-6 border-b border-gray-200 dark:border-gray-700 pb-6 last:border-b-0 last:mb-0",4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex","items-start","gap-4","mb-6","border-b","border-gray-200","dark:border-gray-700","pb-6","last:border-b-0","last:mb-0"],[1,"w-24","h-24","object-cover","rounded-lg","border","border-gray-300","dark:border-gray-600",3,"src","alt"],[1,"flex-1"],[1,"text-lg","font-bold","text-gray-900","dark:text-white"],[1,"text-sm","text-gray-500","dark:text-gray-400"],[1,"flex","flex-wrap","gap-2","mt-2"],["class","text-xs bg-blue-600 text-white px-2 py-1 rounded",4,"ngFor","ngForOf"],[1,"flex","items-center","gap-2","mt-4"],[1,"cursor-pointer","px-2","py-1","bg-gray-200","dark:bg-gray-700","rounded","hover:bg-gray-300","dark:hover:bg-gray-600","text-black","dark:text-white","transition",3,"click"],[1,"fas","fa-minus"],[1,"text-sm","font-medium","text-gray-800","dark:text-white"],[1,"fas","fa-plus"],[1,"cursor-pointer","ml-auto","text-red-500","hover:text-red-700","transition",3,"click"],[1,"fas","fa-trash-alt"],[1,"text-right","text-green-600","dark:text-green-400","font-semibold","text-lg","ml-4","whitespace-nowrap"],[1,"text-xs","bg-blue-600","text-white","px-2","py-1","rounded"],[1,"text-center","py-12","text-gray-500","dark:text-gray-400"],[1,"fas","fa-shopping-cart","text-5xl","mb-4"],[1,"text-xl","font-semibold"],[1,"mt-2"],["routerLink","/",1,"cursor-pointer","mt-4","inline-block","px-6","py-2","bg-blue-600","text-white","rounded-lg","shadow","hover:bg-blue-700","transition"]],template:function(t,s){if(t&1){let c=w();e(0,"div",1)(1,"div",2)(2,"div",3),k(3,L,2,2,"ng-container",4)(4,H,8,0,"ng-template",null,0,M),r()(),e(6,"div",5)(7,"h2",6),i(8," Resumen de Compra "),r(),e(9,"div",7)(10,"div",8)(11,"span"),i(12,"Productos"),r(),e(13,"span"),i(14),r()(),e(15,"div",8)(16,"span"),i(17,"Total Neto"),r(),e(18,"span",9),i(19),b(20,"number"),r()(),e(21,"div",8)(22,"span"),i(23,"Env\xEDo"),r(),e(24,"span"),i(25,"Gratis \u{1F69A}"),r()()(),p(26,"hr",10),e(27,"div",11)(28,"span"),i(29,"Total a Pagar"),r(),e(30,"span",12),i(31),b(32,"number"),r()(),e(33,"button",13),f("click",function(){return g(c),x(s.onPay())}),i(34," Confirmar y Pagar "),r(),e(35,"p",14),i(36," Al pagar aceptas nuestros "),e(37,"a",15),i(38,"t\xE9rminos y condiciones"),r(),i(39,". "),r()()()}if(t&2){let c=F(5);n(3),d("ngIf",s.cart().length>0)("ngIfElse",c),n(3),d("@fadeInOut",void 0),n(8),E(s.cart().length),n(5),m("$",v(20,7,s.total(),"1.2-2"),""),n(12),m("$",v(32,10,s.total(),"1.2-2"),""),n(2),d("disabled",s.cart().length===0)}},dependencies:[Q,V,O,$,B,A,j],styles:["button[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed}"],data:{animation:[C("dropToCart",[h(":enter",[u({transform:"translateY(-20px)",opacity:0}),_("200ms ease-out",u({transform:"translateY(0)",opacity:1}))])]),C("removeFromCart",[h(":leave",[_("200ms ease-in",u({transform:"translateX(40px)",opacity:0}))])]),C("fadeInOut",[h(":enter",[u({opacity:0,transform:"translateY(-10px)"}),_("300ms ease-out",u({opacity:1,transform:"translateY(0)"}))]),h(":leave",[_("200ms ease-in",u({opacity:0,transform:"translateY(10px)"}))])])]}})};export{q as PaymentComponent};
