import{a as z}from"./chunk-BQ562IZZ.js";import{a as N}from"./chunk-YRR5DQPE.js";import{e as T}from"./chunk-JFV6WPIM.js";import"./chunk-3SYVYTXG.js";import{$ as b,$a as n,Aa as o,Ea as f,Ja as S,Oa as u,Tb as P,Ub as k,Va as l,Vb as w,Xb as O,Yb as D,_ as v,_a as r,_b as F,ab as m,db as C,eb as _,fb as c,kb as d,lb as I,mb as s,nb as E,ub as h,vb as g,xa as y,xb as x}from"./chunk-C5O2SOKF.js";var j=(i,a)=>({"cursor-pointer":i,"cursor-not-allowed":a});function $(i,a){i&1&&(r(0,"div",6),m(1,"i",7),r(2,"p",8),d(3,"Cargando tus compras..."),n()())}function B(i,a){if(i&1&&(r(0,"div",9),d(1),n()),i&2){let e=c();o(),s(" ",e.error," ")}}function M(i,a){i&1&&(r(0,"div",10),m(1,"i",11),r(2,"p",12),d(3,"No tienes compras registradas."),n()())}function V(i,a){if(i&1&&(r(0,"tr",28)(1,"td",29),m(2,"img",30),r(3,"div")(4,"div",31),d(5),n(),r(6,"div",32),d(7),n()()(),r(8,"td",33),d(9),n(),r(10,"td",33),d(11),g(12,"number"),n(),r(13,"td",34),d(14),g(15,"number"),n()()),i&2){let e=a.$implicit,t=c(4);o(2),l("src",t.productDetails[e.id_prod].imagen_url||"https://via.placeholder.com/60",y)("alt",t.productDetails[e.id_prod].nombre||"Producto desconocido"),o(3),s(" ",t.productDetails[e.id_prod].nombre||"Producto desconocido"," "),o(2),s(" ID: ",e.id_prod," "),o(2),I(e.cantidad),o(2),s(" $",x(12,7,t.productDetails[e.id_prod].precio||e.precio_unitario,"1.2-2")," "),o(3),s(" $",x(15,10,e.subtotal,"1.2-2")," ")}}function A(i,a){if(i&1&&(r(0,"div",13)(1,"table",24)(2,"thead")(3,"tr",25)(4,"th",26),d(5,"Producto"),n(),r(6,"th",26),d(7,"Cantidad"),n(),r(8,"th",26),d(9,"Precio Unitario"),n(),r(10,"th",26),d(11,"Subtotal"),n()()(),r(12,"tbody"),u(13,V,16,13,"tr",27),n()()()),i&2){let e=c().$implicit;o(13),l("ngForOf",e.productos)}}function R(i,a){if(i&1&&(r(0,"div",16)(1,"div",17)(2,"div")(3,"div",18),d(4),g(5,"date"),n(),r(6,"div",19),d(7," Cliente: "),r(8,"span",20),d(9),n(),m(10,"br"),d(11),n()(),r(12,"div",21)(13,"div",19),d(14,"Total pagado:"),n(),r(15,"div",22),d(16),g(17,"number"),n()()(),r(18,"div",23),u(19,A,14,1,"div",4),n()()),i&2){let e=a.$implicit,t=c(2);o(4),s("Compra del ",x(5,6,e.fecha,"mediumDate"),""),o(5),E("",e.usuario_info.nombre," ",e.usuario_info.apellido,""),o(2),s(" \u{1F4E7} ",e.usuario_info.correo," "),o(5),s("$",x(17,9,e.total,"1.2-2"),""),o(3),l("ngIf",!t.loading&&!t.error&&t.facturas.length>0&&t.productsLoaded)}}function U(i,a){if(i&1&&(r(0,"div",13)(1,"h2",14),d(2,"\u{1F9FE}\u2705 Tus Compras"),n(),u(3,R,20,12,"div",15),n()),i&2){let e=c();o(3),l("ngForOf",e.facturas)}}function q(i,a){if(i&1){let e=C();r(0,"nav",35)(1,"ul",36)(2,"li")(3,"button",37),_("click",function(){v(e);let p=c();return b(p.prevPage())}),m(4,"i",38),d(5," Anterior "),n()(),r(6,"li")(7,"span",39),d(8),n()(),r(9,"li")(10,"button",37),_("click",function(){v(e);let p=c();return b(p.nextPage())}),d(11," Siguiente "),m(12,"i",40),n()()()()}if(i&2){let e=c();o(3),l("disabled",e.currentPage===0)("ngClass",h(5,j,e.currentPage!==0,e.currentPage===0)),o(5),s(" P\xE1gina ",e.currentPage+1," "),o(2),l("disabled",e.facturas.length<e.pageSize)("ngClass",h(8,j,e.facturas.length===e.pageSize,e.facturas.length<e.pageSize))}}var L=class i{constructor(a,e,t){this.facturaService=a;this.router=e;this.productService=t}facturas=[];loading=!0;productsLoaded=!1;error=null;productDetails={};currentPage=0;pageSize=5;ngOnInit(){this.loadFacturas()}loadFacturas(){let a=localStorage.getItem("usuario_id");if(!a){this.router.navigate(["/"]);return}this.loading=!0,this.productsLoaded=!1,this.facturaService.obtenerFacturas({usuario_id:Number(a),skip:this.currentPage*this.pageSize,limit:this.pageSize}).subscribe({next:e=>{this.facturas=Array.isArray(e)?e:e.facturas||[],this.loadProductDetails()},error:e=>{this.error="No se pudieron cargar las facturas.",this.loading=!1}})}nextPage(){this.facturas.length===this.pageSize&&(this.currentPage++,this.loadFacturas())}prevPage(){this.currentPage>0&&(this.currentPage--,this.loadFacturas())}loadProductDetails(){let a=new Set;if(this.facturas.forEach(t=>{t.productos.forEach(p=>{a.add(p.id_prod)})}),a.size===0){this.productsLoaded=!0,this.loading=!1;return}let e=0;a.forEach(t=>{this.productService.getProductById(t).subscribe({next:p=>{this.productDetails[t]=p,e++,e===a.size&&(this.productsLoaded=!0,this.loading=!1)},error:()=>{this.productDetails[t]={id_producto:t,nombre:"Producto no disponible",direccion:"",precio:0,stock:0,imagen_url:"https://via.placeholder.com/60",fecha_creacion:"",proveedor:"",categorias:[]},e++,e===a.size&&(this.productsLoaded=!0,this.loading=!1)}})})}static \u0275fac=function(e){return new(e||i)(f(N),f(T),f(z))};static \u0275cmp=S({type:i,selectors:[["orders"]],decls:6,vars:5,consts:[[1,"mt-24"],["class","flex flex-col items-center py-10 text-center text-blue-600",4,"ngIf"],["class","text-red-500 text-center py-10 text-lg font-semibold",4,"ngIf"],["class","text-center py-10 text-gray-500 dark:text-gray-400",4,"ngIf"],["class","max-w-5xl mx-auto px-4",4,"ngIf"],["class","flex justify-center mt-6 mb-16",4,"ngIf"],[1,"flex","flex-col","items-center","py-10","text-center","text-blue-600"],[1,"fa-solid","fa-spinner","fa-spin","text-3xl","mb-2"],[1,"text-lg","font-medium"],[1,"text-red-500","text-center","py-10","text-lg","font-semibold"],[1,"text-center","py-10","text-gray-500","dark:text-gray-400"],[1,"fa-solid","fa-box-open","text-4xl","mb-2"],[1,"text-lg"],[1,"max-w-5xl","mx-auto","px-4"],[1,"text-2xl","font-bold","mb-6","text-gray-800"],["class","mb-8 p-6 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 shadow-md",4,"ngFor","ngForOf"],[1,"mb-8","p-6","rounded-lg","border","border-gray-200","dark:border-gray-700","bg-white","dark:bg-gray-800","shadow-md"],[1,"flex","justify-between","items-center","mb-4","flex-wrap","gap-4"],[1,"text-lg","font-semibold","text-gray-800","dark:text-white"],[1,"text-sm","text-gray-500","dark:text-gray-400"],[1,"font-semibold"],[1,"text-right"],[1,"text-2xl","font-bold","text-green-600","dark:text-green-400"],[1,"overflow-x-auto","mt-4"],[1,"min-w-full","text-sm","border-t","border-gray-200","dark:border-gray-600"],[1,"text-left","bg-gray-100","dark:bg-gray-700","text-gray-700","dark:text-gray-200"],[1,"p-3"],["class","border-b border-gray-200 dark:border-gray-700",4,"ngFor","ngForOf"],[1,"border-b","border-gray-200","dark:border-gray-700"],[1,"p-3","flex","items-center","gap-4"],[1,"w-14","h-14","rounded","object-cover","border","border-gray-300","dark:border-gray-600",3,"src","alt"],[1,"font-medium","text-gray-900","dark:text-white"],[1,"text-xs","text-gray-500","dark:text-gray-400"],[1,"p-3","text-gray-800","dark:text-gray-200"],[1,"p-3","text-green-600","dark:text-green-400","font-semibold"],[1,"flex","justify-center","mt-6","mb-16"],[1,"flex","items-center","space-x-2"],[1,"px-4","h-10","text-sm","text-gray-600","bg-white","border","border-gray-300","rounded-lg","hover:bg-gray-200","transition","disabled:opacity-50",3,"click","disabled","ngClass"],[1,"fas","fa-chevron-left"],[1,"px-4","py-2","bg-blue-600","text-white","rounded-lg","font-semibold"],[1,"fas","fa-chevron-right"]],template:function(e,t){e&1&&(r(0,"div",0),u(1,$,4,0,"div",1)(2,B,2,1,"div",2)(3,M,4,0,"div",3)(4,U,4,1,"div",4)(5,q,13,11,"nav",5),n()),e&2&&(o(),l("ngIf",t.loading),o(),l("ngIf",t.error),o(),l("ngIf",!t.loading&&!t.error&&t.facturas.length===0),o(),l("ngIf",!t.loading&&!t.error&&t.facturas.length>0),o(),l("ngIf",!t.loading&&!t.error&&t.facturas.length>0))},dependencies:[F,P,k,w,D,O],styles:[".fa-spin[_ngcontent-%COMP%]{animation:fa-spin 2s infinite linear}.text-glow-success[_ngcontent-%COMP%]{text-shadow:0 0 10px #10b981aa,0 0 20px #10b98188}"]})};export{L as OrdersComponent};
